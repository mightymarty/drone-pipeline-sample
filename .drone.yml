kind: pipeline
name: sample-drone-pipeline

steps:
- name: build
  image: microsoft/dotnet
  commands:
  - dotnet build ./sample-app/

- name: infrastructure
  image: remkoseelig/terraform-azure-cli
  environment:
    azusername:
      from_secret: azusername
    azpassword:
      from_secret: azpassword
  commands:
  - az login --service-principal -u $azusername -p $azpassword --tenant $aztenant
  - terraform init
  - terraform apply -auto-approve
